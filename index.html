<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEME MUSEUM - The History of Internet Culture</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        :root {
            --bg-dark: #0a0a0f;
            --gold: #D4AF37;
            --gold-light: #F0D060;
            --gold-dark: #8B7024;
            --gold-glow: rgba(212, 175, 55, 0.4);
            --text: #ffffff;
            --text-dim: #c0c0c0;
            --card-border: rgba(212, 175, 55, 0.15);
        }

        body {
            font-family: 'Space Mono', monospace;
            background: var(--bg-dark);
            color: var(--text);
            overflow-x: hidden;
        }

        body.no-scroll {
            overflow: hidden;
        }

        /* ==================== VIDEO BACKGROUND ==================== */
        #bgVideo {
            position: fixed;
            top: 50%;
            left: 50%;
            min-width: 100%;
            min-height: 100%;
            transform: translate(-50%, -50%);
            z-index: 0;
            object-fit: cover;
            filter: blur(5px) brightness(0.4);
        }

        .video-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(7, 7, 10, 0.6);
            z-index: 1;
        }

        /* ==================== NAVBAR ==================== */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(7, 7, 10, 0);
            backdrop-filter: blur(0px);
            z-index: 100;
            transition: all 0.3s ease;
        }

        .navbar.scrolled {
            background: rgba(7, 7, 10, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(212, 175, 55, 0.1);
        }

        .navbar-logo {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .navbar-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--gold);
        }

        .navbar-links {
            display: flex;
            gap: 2rem;
            font-family: 'Space Mono', monospace;
            font-size: 0.9rem;
        }

        .navbar-links a {
            color: var(--text-dim);
            text-decoration: none;
            transition: color 0.3s ease;
            cursor: pointer;
        }

        .navbar-links a:hover {
            color: var(--gold);
        }

        /* ==================== SECTIONS ==================== */
        section {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            position: relative;
        }

        /* ==================== SECTION 1 - HERO ==================== */
        #hero {
            background: transparent;
            position: relative;
            overflow: hidden;
        }

        .particles-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.2;
            z-index: 0;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .hero-title {
            font-size: clamp(3rem, 10vw, 7rem);
            font-weight: 600;
            font-family: 'Cinzel', serif;
            letter-spacing: 0.05em;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #F0D060, #D4AF37, #8B7024, #D4AF37, #F0D060);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            background-size: 200% auto;
            animation: goldShimmer 3s ease infinite;
        }

        @keyframes goldShimmer {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .hero-subtitle {
            font-size: clamp(1rem, 2vw, 1.5rem);
            color: var(--text-dim);
            font-family: 'Space Mono', monospace;
            font-style: italic;
            margin-bottom: 3rem;
        }


        /* ==================== SECTION 2 - ABOUT ==================== */
        #about {
            background: transparent;
        }

        .section-title {
            font-size: clamp(2.5rem, 6vw, 4rem);
            font-weight: 600;
            font-family: 'Cinzel', serif;
            margin-bottom: 2.5rem;
            color: var(--gold);
            text-align: left;
        }

        .about-content {
            max-width: 900px;
            text-align: left;
        }

        .about-text {
            font-family: 'Space Mono', monospace;
            font-size: 1.05rem;
            line-height: 1.9;
            color: var(--text-dim);
            margin-bottom: 1.5rem;
        }

        .social-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-start;
            margin-top: 2.5rem;
            margin-bottom: 1rem;
        }

        .social-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.75rem;
            font-family: 'Space Mono', monospace;
            font-size: 0.95rem;
            color: var(--gold);
            background: transparent;
            border: 1px solid var(--gold);
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .social-btn:hover {
            background: var(--gold);
            color: #0a0a0f;
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        .social-icon {
            font-size: 1.2rem;
        }

        .stats-grid {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 3rem;
            margin-top: 4rem;
            padding: 2rem 0;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .stat-card {
            text-align: left;
            padding: 0 3rem;
            position: relative;
        }

        .stat-card:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 60px;
            background: rgba(212, 175, 55, 0.3);
        }

        .stat-number {
            font-size: 3.5rem;
            font-weight: 700;
            font-family: 'Cinzel', serif;
            background: linear-gradient(135deg, #F0D060, #D4AF37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* ==================== ENTER BUTTON (IN HERO) ==================== */
        .enter-btn {
            padding: 1.8rem 5rem;
            font-size: 1.3rem;
            font-weight: 600;
            font-family: 'Cinzel', serif;
            background: var(--gold);
            color: #0a0a0f;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            position: relative;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }

        .enter-btn:hover:not(:disabled) {
            background: var(--gold-light);
            box-shadow: 0 6px 25px rgba(212, 175, 55, 0.5);
            transform: translateY(-3px);
        }

        .enter-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .enter-btn.loaded {
            animation: glow 2s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px var(--gold-glow); }
            50% { box-shadow: 0 0 40px var(--gold-glow), 0 0 80px var(--gold-glow); }
        }

        .loading-bar-mini {
            width: 300px;
            height: 3px;
            background: rgba(212, 175, 55, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 0 auto 1rem;
        }

        .loading-bar-fill {
            height: 100%;
            background: var(--gold);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 10px var(--gold-glow);
        }


        .ca-address {
            font-family: 'Space Mono', monospace;
            font-size: 14px;
            color: var(--gold);
            cursor: pointer;
            padding: 12px 24px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 8px;
            background: rgba(212, 175, 55, 0.05);
            transition: all 0.3s ease;
            user-select: all;
            word-break: break-all;
            max-width: 500px;
            margin: 20px auto;
            text-align: center;
            display: block;
        }

        .ca-address:hover {
            background: rgba(212, 175, 55, 0.1);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.2);
        }

        /* ==================== REVEAL ANIMATION ==================== */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* ==================== LANDING PAGE CONTAINER ==================== */
        #landingPage {
            width: 100%;
            height: auto;
            position: relative;
            z-index: 2;
            transition: opacity 0.5s ease;
        }

        #landingPage.hidden {
            opacity: 0;
            pointer-events: none;
            position: absolute;
        }

        /* ==================== GOLD FLASH ==================== */
        #greenFlash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, var(--gold), var(--gold-dark));
            opacity: 0;
            pointer-events: none;
            z-index: 10000;
        }

        #greenFlash.active {
            animation: flashGold 0.6s ease forwards;
        }

        @keyframes flashGold {
            0% { opacity: 0; }
            30% { opacity: 0.9; }
            100% { opacity: 0; }
        }

        /* ==================== MEME MUSEUM 3D ==================== */
        #gameCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            z-index: 9000;
        }

        #gameCanvas.active {
            display: block;
        }

        /* HUD */
        .hud {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 9001;
        }

        .hud.active {
            opacity: 1;
        }

        .crosshair {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .crosshair-dot {
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .crosshair-ring {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        /* Mute Button */
        #muteBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(212, 175, 55, 0.3);
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: all;
            transition: all 0.3s ease;
            z-index: 9001;
        }

        #muteBtn:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: var(--gold);
            transform: scale(1.1);
        }

        /* Pause Screen */
        .screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9002;
        }

        .screen.active {
            opacity: 1;
            pointer-events: all;
        }

        #pauseScreen {
            background: rgba(7, 7, 10, 0.8);
            backdrop-filter: blur(20px);
        }

        .pause-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
        }

        .pause-title {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .pause-hint {
            font-size: 1.1rem;
            color: var(--text-dim);
            font-family: 'Space Mono', monospace;
            margin-bottom: 2rem;
        }

        .pause-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }

        .pause-btn {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: 'Syne', sans-serif;
            background: transparent;
            color: var(--gold);
            border: 2px solid var(--gold);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .pause-btn:hover {
            background: var(--gold);
            color: #0a0a0f;
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.6);
            transform: translateY(-2px);
        }

        /* Hidden stats elements */
        .hidden-stats {
            display: none;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .navbar-links {
                display: none;
            }

            .stats-grid {
                flex-direction: column;
                align-items: flex-start;
                gap: 2rem;
            }

            .stat-card {
                padding: 0;
            }

            .stat-card:not(:last-child)::after {
                display: none;
            }

            .about-content {
                text-align: center;
            }

            .section-title {
                text-align: center;
            }

            .social-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Video Background -->
    <video id="bgVideo" autoplay muted loop playsinline>
        <source src="https://pub-8d7b1a002dc7461881f41950b1c60105.r2.dev/fundo1.mp4" type="video/mp4">
    </video>
    <div class="video-overlay"></div>

    <!-- Navbar -->
    <nav class="navbar" id="navbar">
        <div class="navbar-logo">
            <span class="navbar-title">MEME MUSEUM</span>
        </div>
        <div class="navbar-links">
            <a href="#about">About</a>
        </div>
    </nav>

    <!-- Landing Page (all sections) -->
    <div id="landingPage">
        <!-- SECTION 1 - HERO -->
        <section id="hero">
            <div class="particles-bg" id="particlesBg"></div>
            <div class="hero-content">
                <h1 class="hero-title">MEME MUSEUM</h1>
                <p class="hero-subtitle">The History of Internet Culture</p>
                <button id="enterBtn" class="enter-btn" disabled>LOADING...</button>
                <div class="loading-bar-mini">
                    <div class="loading-bar-fill" id="loadingFill"></div>
                </div>
                <div class="ca-address" id="caAddress">CA: B2H3YQz3daShD1yhwouXtGpPB1vANepUVU9xW9mzpump</div>
            </div>
        </section>

        <!-- SECTION 2 - ABOUT -->
        <section id="about">
            <div class="about-content reveal">
                <h2 class="section-title">What is Meme Museum?</h2>
                <p class="about-text">
                    Step into the world's first 3D Meme Museum dedicated to internet meme culture.
                    Walk through our halls and discover the origins of the most iconic memes
                    that shaped online culture ‚Äî from Doge to Pepe, from Trollface to Wojak.
                </p>
                <p class="about-text">
                    Built on the spirit of pump.fun and the crypto meme community,
                    Meme Museum celebrates the art, humor, and creativity that connects
                    millions of people worldwide.
                </p>

                <div class="social-buttons">
                    <a href="https://x.com/MemeMuseum_" target="_blank" rel="noopener noreferrer" class="social-btn">
                        <span class="social-icon">ùïè</span>
                        <span>Follow us on X</span>
                    </a>
                    <a href="https://x.com/i/communities/2018913269407170741" target="_blank" rel="noopener noreferrer" class="social-btn">
                        <span class="social-icon">üí¨</span>
                        <span>Join Community</span>
                    </a>
                </div>

                <div class="stats-grid reveal">
                    <div class="stat-card">
                        <div class="stat-number">24+</div>
                        <div class="stat-label">Meme Monuments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">3D Experience</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">FREE</div>
                        <div class="stat-label">To Explore</div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Gold flash overlay -->
    <div id="greenFlash"></div>

    <!-- Meme Museum 3D -->
    <canvas id="gameCanvas"></canvas>

    <!-- Pause Screen -->
    <div id="pauseScreen" class="screen">
        <div class="pause-card">
            <h2 class="pause-title">PAUSED</h2>
            <p class="pause-hint">Press ESC to resume</p>
            <div class="pause-buttons">
                <button id="resumeBtn" class="pause-btn">RESUME</button>
                <button id="backHomeBtn" class="pause-btn">BACK TO HOME</button>
            </div>
        </div>
    </div>

    <!-- HUD -->
    <div class="hud" id="hud">
        <div class="crosshair">
            <div class="crosshair-dot"></div>
            <div class="crosshair-ring"></div>
        </div>
        <button id="muteBtn" title="Toggle Music">üîä</button>
        <!-- Hidden stats to prevent JS errors -->
        <div class="hidden-stats">
            <span id="exposureValue">0.80</span>
            <input id="exposureSlider" value="0.8">
            <span id="fps">0</span>
            <span id="meshCount">0</span>
            <span id="triCount">0</span>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';

        // ==================== LANDING PAGE ANIMATIONS ====================

        // Particles background
        function initParticles() {
            const container = document.getElementById('particlesBg');
            const particleCount = 30;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.style.position = 'absolute';
                particle.style.width = '2px';
                particle.style.height = '2px';
                particle.style.background = 'var(--gold)';
                particle.style.borderRadius = '50%';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animation = `float ${8 + Math.random() * 4}s ease-in-out infinite`;
                particle.style.animationDelay = `${Math.random() * 10}s`;
                container.appendChild(particle);
            }
        }

        // Float animation for particles
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
                25% { opacity: 0.5; }
                50% { opacity: 1; }
                75% { opacity: 0.5; }
            }
        `;
        document.head.appendChild(style);

        initParticles();

        // Navbar scroll effect
        const navbar = document.getElementById('navbar');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 100) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        });

        // IntersectionObserver for reveal animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

        // ==================== MEME MUSEUM ENGINE ====================

        class MuseumEngine {
            constructor() {
                // DOM elements
                this.landingPage = document.getElementById('landingPage');
                this.enterBtn = document.getElementById('enterBtn');
                this.loadingFill = document.getElementById('loadingFill');
                this.greenFlash = document.getElementById('greenFlash');
                this.pauseScreen = document.getElementById('pauseScreen');
                this.canvas = document.getElementById('gameCanvas');
                this.hud = document.getElementById('hud');

                // Three.js core
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.clock = new THREE.Clock();

                // Player state
                this.player = {
                    position: new THREE.Vector3(0, 3.0, 0),
                    velocity: new THREE.Vector3(),
                    yaw: 0,
                    pitch: 0,
                    speed: 6,
                    sprintSpeed: 12,
                    jumpSpeed: 7,
                    gravity: 22,
                    radius: 0.35,
                    height: 3.0,
                    onGround: false
                };

                // Input state
                this.keys = {};
                this.mouseMovement = { x: 0, y: 0 };
                this.mouseSensitivity = 0.002;

                // Game state
                this.isPointerLocked = false;
                this.isPaused = false;
                this.isLooping = false;
                this.modelLoaded = false;
                this.colliders = [];
                this.mixer = null;

                // Background music
                this.bgMusic = new Audio('https://pub-8d7b1a002dc7461881f41950b1c60105.r2.dev/museum-ambient.mp3');
                this.bgMusic.loop = true;
                this.bgMusic.volume = 0;
                this.isMuted = false;

                // Raycaster for ground detection
                this.downRay = new THREE.Raycaster();

                // Stats
                this.frameCount = 0;
                this.lastFpsUpdate = 0;
                this.meshCount = 0;
                this.triCount = 0;

                this.init();
            }

            init() {
                this.setupScene();
                this.setupEventListeners();
                // Start loading immediately in background
                this.loadModel();
            }

            setupScene() {
                // Scene
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x111111);

                // Camera
                this.camera = new THREE.PerspectiveCamera(
                    75,
                    window.innerWidth / window.innerHeight,
                    0.1,
                    1000
                );

                // Renderer
                this.renderer = new THREE.WebGLRenderer({
                    canvas: this.canvas,
                    antialias: false,
                    powerPreference: 'high-performance'
                });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(1);
                this.renderer.shadowMap.enabled = false;

                // Color settings
                this.renderer.outputColorSpace = THREE.SRGBColorSpace;
                this.renderer.toneMapping = THREE.ReinhardToneMapping;
                this.renderer.toneMappingExposure = 0.8;
            }

            setupEventListeners() {
                // Enter button click
                this.enterBtn.addEventListener('click', () => {
                    if (this.modelLoaded) {
                        this.startTransition();
                    }
                });

                // Pointer lock
                document.addEventListener('pointerlockchange', () => {
                    this.isPointerLocked = document.pointerLockElement === this.canvas;
                    this.hud.classList.toggle('active', this.isPointerLocked);
                    if (!this.isPointerLocked && !this.isPaused) {
                        this.pause();
                    }
                });

                // Mouse movement
                document.addEventListener('mousemove', (e) => {
                    if (this.isPointerLocked) {
                        this.mouseMovement.x = e.movementX;
                        this.mouseMovement.y = e.movementY;
                    }
                });

                // Keyboard
                document.addEventListener('keydown', (e) => {
                    this.keys[e.code] = true;

                    if (e.code === 'Escape') {
                        if (this.isPointerLocked) {
                            document.exitPointerLock();
                        }
                    }

                    if (e.code === 'KeyF') {
                        this.toggleFullscreen();
                    }

                    if (e.code === 'KeyP') {
                        const p = this.player.position;
                        const y = this.player.yaw;
                        console.log(`x=${p.x.toFixed(2)}, y=${p.y.toFixed(2)}, z=${p.z.toFixed(2)}, yaw=${y.toFixed(4)}`);
                    }
                });

                document.addEventListener('keyup', (e) => {
                    this.keys[e.code] = false;
                });

                // Pause screen buttons
                document.getElementById('resumeBtn').addEventListener('click', () => {
                    this.resume();
                });

                document.getElementById('backHomeBtn').addEventListener('click', () => {
                    this.backToHome();
                });

                // Mute button
                document.getElementById('muteBtn').addEventListener('click', () => {
                    this.toggleMute();
                });

                // CA address copy
                document.getElementById('caAddress').addEventListener('click', function() {
                    navigator.clipboard.writeText('B2H3YQz3daShD1yhwouXtGpPB1vANepUVU9xW9mzpump');
                    const original = this.textContent;
                    this.textContent = 'Copied!';
                    setTimeout(() => { this.textContent = original; }, 2000);
                });

                // Window resize
                window.addEventListener('resize', () => {
                    this.camera.aspect = window.innerWidth / window.innerHeight;
                    this.camera.updateProjectionMatrix();
                    this.renderer.setSize(window.innerWidth, window.innerHeight);
                });
            }

            loadModel() {
                // Setup loaders
                const dracoLoader = new DRACOLoader();
                dracoLoader.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.5.6/');

                const gltfLoader = new GLTFLoader();
                gltfLoader.setDRACOLoader(dracoLoader);

                // Load GLB file
                gltfLoader.load(
                    'https://pub-8d7b1a002dc7461881f41950b1c60105.r2.dev/museu%20memes1.glb',
                    (gltf) => {
                        this.onModelLoaded(gltf);
                    },
                    (progress) => {
                        if (progress.lengthComputable) {
                            const percent = Math.round((progress.loaded / progress.total) * 100);
                            this.loadingFill.style.width = `${percent}%`;
                            console.log(`Loading: ${percent}%`);
                        }
                    },
                    (error) => {
                        console.error('Error loading model:', error);
                        this.enterBtn.textContent = 'ERROR - CHECK CONSOLE';
                        alert('Error: File "museu memes1.glb" not found. Make sure it is in the same folder as index.html');
                    }
                );
            }

            setupLighting(hasModelLights) {
                if (hasModelLights) {
                    return;
                }
                const ambient = new THREE.AmbientLight(0xffffff, 0.5);
                this.scene.add(ambient);
            }

            onModelLoaded(gltf) {
                console.log('Model loaded successfully');

                const model = gltf.scene;

                // Check if model has lights
                let hasModelLights = false;
                let lightCount = 0;
                model.traverse((child) => {
                    if (child.isLight) {
                        hasModelLights = true;
                        lightCount++;
                        // Reduce Blender lights significantly
                        child.intensity = child.intensity / 1000;
                    }
                    if (child.isMesh && child.material) {
                        const mats = Array.isArray(child.material) ? child.material : [child.material];
                        mats.forEach(mat => {
                            if (mat.roughness !== undefined) {
                                mat.roughness = Math.max(mat.roughness, 0.6);
                            }
                        });
                    }
                });
                console.log(`Lights found: ${lightCount}`);

                this.setupLighting(hasModelLights);

                // Calculate bounding box
                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());

                // Center model
                model.position.x = -center.x;
                model.position.z = -center.z;
                model.position.y = -box.min.y;

                // Count meshes and triangles
                this.meshCount = 0;
                this.triCount = 0;

                model.traverse((child) => {
                    if (child.isMesh) {
                        this.meshCount++;
                        if (child.geometry) {
                            const positions = child.geometry.attributes.position;
                            if (positions) {
                                this.triCount += positions.count / 3;
                            }
                        }
                    }
                });

                this.triCount = Math.round(this.triCount);

                // Collect meshes for collision
                this.colliders = [];
                model.traverse((child) => {
                    if (child.isMesh) {
                        this.colliders.push(child);
                    }
                });

                // Wall collision raycaster
                this.wallRay = new THREE.Raycaster();

                // Setup animations
                if (gltf.animations && gltf.animations.length > 0) {
                    this.mixer = new THREE.AnimationMixer(model);
                    gltf.animations.forEach((clip) => {
                        this.mixer.clipAction(clip).play();
                    });
                }

                // Add model to scene
                this.scene.add(model);

                // Position player at spawn point
                this.player.position.set(-0.83, 4.04, -2.58);
                this.player.yaw = -11.0240;
                this.player.pitch = 0;
                console.log(`Spawn: x=-0.83, y=4.04, z=-2.58, yaw=-11.0240`);

                // Initialize camera position immediately
                this.camera.position.copy(this.player.position);
                this.camera.rotation.order = 'YXZ';
                this.camera.rotation.y = this.player.yaw;
                this.camera.rotation.x = this.player.pitch;

                // Enable enter button
                this.modelLoaded = true;
                this.loadingFill.style.width = '100%';
                this.enterBtn.disabled = false;
                this.enterBtn.textContent = 'ENTER MEME MUSEUM';
                this.enterBtn.classList.add('loaded');

                console.log('Ready! Click ENTER MEME MUSEUM.');
            }

            startTransition() {
                // Disable scroll
                document.body.classList.add('no-scroll');

                // Gold flash
                this.greenFlash.classList.add('active');

                // After flash, show meme museum
                setTimeout(() => {
                    // Hide landing page
                    this.landingPage.classList.add('hidden');

                    // Hide video background
                    const bgVideo = document.getElementById('bgVideo');
                    if (bgVideo) bgVideo.style.display = 'none';

                    // Show canvas
                    this.canvas.classList.add('active');
                    console.log('Canvas visible');

                    // Remove gold flash
                    this.greenFlash.classList.remove('active');

                    // Debug info
                    console.log('Scene children:', this.scene.children.length);
                    console.log('Camera position:', this.camera.position);
                    console.log('Player position:', this.player.position);

                    // Request pointer lock automatically
                    this.canvas.requestPointerLock();

                    // Start background music with fade-in
                    this.bgMusic.volume = 0;
                    this.bgMusic.play().catch(e => console.log('Music autoplay prevented:', e));
                    this.fadeInMusic();

                    // Start game loop if not already running
                    if (!this.isLooping) {
                        this.isLooping = true;
                        console.log('Render loop started');
                        this.loop();
                    }
                }, 600);
            }

            fadeInMusic() {
                const fadeIn = setInterval(() => {
                    if (this.bgMusic.volume < 0.15) {
                        this.bgMusic.volume = Math.min(this.bgMusic.volume + 0.01, 0.15);
                    } else {
                        clearInterval(fadeIn);
                    }
                }, 100);
            }

            fadeOutMusic() {
                const fadeOut = setInterval(() => {
                    if (this.bgMusic.volume > 0.01) {
                        this.bgMusic.volume = Math.max(this.bgMusic.volume - 0.01, 0);
                    } else {
                        this.bgMusic.pause();
                        clearInterval(fadeOut);
                    }
                }, 100);
            }

            pause() {
                this.isPaused = true;
                this.pauseScreen.classList.add('active');
                // Reduce music volume when paused
                if (!this.isMuted) {
                    this.bgMusic.volume = 0.05;
                }
            }

            resume() {
                this.isPaused = false;
                this.pauseScreen.classList.remove('active');
                this.canvas.requestPointerLock();
                // Restore music volume when resuming
                if (!this.isMuted) {
                    this.bgMusic.volume = 0.15;
                }
            }

            backToHome() {
                // Exit pointer lock
                if (document.pointerLockElement) {
                    document.exitPointerLock();
                }

                // Fade out and stop music
                this.fadeOutMusic();

                // Stop render loop
                this.isLooping = false;

                // Hide pause screen
                this.pauseScreen.classList.remove('active');
                this.isPaused = false;

                // Hide canvas and HUD
                this.canvas.classList.remove('active');
                this.hud.classList.remove('active');

                // Show video background
                const bgVideo = document.getElementById('bgVideo');
                if (bgVideo) bgVideo.style.display = 'block';

                // Show landing page
                this.landingPage.classList.remove('hidden');

                // Enable scroll
                document.body.classList.remove('no-scroll');

                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });

                console.log('Returned to landing page');
            }

            toggleFullscreen() {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }

            toggleMute() {
                this.isMuted = !this.isMuted;
                const muteBtn = document.getElementById('muteBtn');
                if (this.isMuted) {
                    this.bgMusic.volume = 0;
                    muteBtn.textContent = 'üîá';
                } else {
                    this.bgMusic.volume = this.isPaused ? 0.05 : 0.15;
                    muteBtn.textContent = 'üîä';
                }
            }

            updatePlayer(delta) {
                if (this.isPaused || !this.isPointerLocked) return;

                delta = Math.min(delta, 0.1);

                // Mouse look
                this.player.yaw -= this.mouseMovement.x * this.mouseSensitivity;
                this.player.pitch -= this.mouseMovement.y * this.mouseSensitivity;
                this.player.pitch = THREE.MathUtils.clamp(
                    this.player.pitch,
                    -Math.PI / 2 + 0.1,
                    Math.PI / 2 - 0.1
                );
                this.mouseMovement.x = 0;
                this.mouseMovement.y = 0;

                // Movement direction
                const forward = new THREE.Vector3(
                    -Math.sin(this.player.yaw),
                    0,
                    -Math.cos(this.player.yaw)
                );
                const right = new THREE.Vector3(
                    Math.sin(this.player.yaw + Math.PI / 2),
                    0,
                    Math.cos(this.player.yaw + Math.PI / 2)
                );

                // Calculate desired velocity
                const moveDir = new THREE.Vector3();
                if (this.keys['KeyW']) moveDir.add(forward);
                if (this.keys['KeyS']) moveDir.sub(forward);
                if (this.keys['KeyD']) moveDir.add(right);
                if (this.keys['KeyA']) moveDir.sub(right);

                if (moveDir.length() > 0) {
                    moveDir.normalize();
                    const speed = this.keys['ShiftLeft'] || this.keys['ShiftRight']
                        ? this.player.sprintSpeed
                        : this.player.speed;

                    const moveX = moveDir.x * speed * delta;
                    const moveZ = moveDir.z * speed * delta;

                    // Wall collision
                    const collisionDist = 1.0;
                    const rayOrigin = this.player.position.clone();

                    let canMoveX = true;
                    let canMoveZ = true;

                    if (Math.abs(moveX) > 0.001) {
                        const dirX = new THREE.Vector3(Math.sign(moveX), 0, 0);
                        this.wallRay.set(rayOrigin, dirX);
                        this.wallRay.far = collisionDist;
                        const hitsX = this.wallRay.intersectObjects(this.colliders, true);
                        if (hitsX.length > 0 && hitsX[0].distance < collisionDist) {
                            canMoveX = false;
                        }
                    }

                    if (Math.abs(moveZ) > 0.001) {
                        const dirZ = new THREE.Vector3(0, 0, Math.sign(moveZ));
                        this.wallRay.set(rayOrigin, dirZ);
                        this.wallRay.far = collisionDist;
                        const hitsZ = this.wallRay.intersectObjects(this.colliders, true);
                        if (hitsZ.length > 0 && hitsZ[0].distance < collisionDist) {
                            canMoveZ = false;
                        }
                    }

                    if (canMoveX) this.player.position.x += moveX;
                    if (canMoveZ) this.player.position.z += moveZ;
                }

                // Gravity
                this.player.velocity.y -= this.player.gravity * delta;
                this.player.position.y += this.player.velocity.y * delta;

                // Ground detection
                this.downRay.set(
                    this.player.position,
                    new THREE.Vector3(0, -1, 0)
                );
                this.downRay.far = this.player.height + 2;
                const groundIntersects = this.downRay.intersectObjects(this.colliders, true);

                if (groundIntersects.length > 0) {
                    const groundY = groundIntersects[0].point.y + this.player.height;
                    if (this.player.position.y <= groundY + 0.2) {
                        this.player.position.y = groundY;
                        this.player.velocity.y = 0;
                        this.player.onGround = true;
                    }
                }

                // Fallback floor
                if (this.player.position.y < this.player.height) {
                    this.player.position.y = this.player.height;
                    this.player.velocity.y = 0;
                    this.player.onGround = true;
                }
            }

            updateStats() {
                this.frameCount++;
                const now = performance.now();
                if (now - this.lastFpsUpdate >= 1000) {
                    const fpsEl = document.getElementById('fps');
                    if (fpsEl) fpsEl.textContent = this.frameCount;
                    this.frameCount = 0;
                    this.lastFpsUpdate = now;
                }
                const meshEl = document.getElementById('meshCount');
                const triEl = document.getElementById('triCount');
                if (meshEl) meshEl.textContent = this.meshCount;
                if (triEl) triEl.textContent = this.triCount.toLocaleString('en-US');
            }

            loop() {
                requestAnimationFrame(() => this.loop());

                const delta = this.clock.getDelta();

                if (!this.isPaused) {
                    this.updatePlayer(delta);
                    if (this.mixer) {
                        this.mixer.update(delta);
                    }
                }

                // Always update camera to player position
                this.camera.position.copy(this.player.position);
                this.camera.rotation.order = 'YXZ';
                this.camera.rotation.y = this.player.yaw;
                this.camera.rotation.x = this.player.pitch;

                // Always render
                this.renderer.render(this.scene, this.camera);
                this.updateStats();
            }
        }

        // Initialize engine
        window.engine = new MuseumEngine();
    </script>
</body>
</html>
